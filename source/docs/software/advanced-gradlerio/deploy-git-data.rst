Including Git Data in Deploy
============================

This article will go over how to include information from Git, such as branch name or commit hash, into the robot code using the `gversion <https://github.com/lessthanoptimal/gversion-plugin>`__ gradle plugin. This is necessary for using such information in robot code, such as printing out commit hash and branch name when the robot starts.

Installing gversion
-------------------

To install gversion add the following line to the plugins block of ``build.gradle``. This tells gradle to use gversion in our project.

.. code-block:: groovy

  plugins {
      // ...
      id "com.peterabeles.gversion" version "1.10"
  }

Next we need to tell gradle to make the file containing our git data when we build the project. To do that add the following block to ``build.gradle``, which adds ``createVersionFile`` as a dependency of ``compileJava``. The ``timeZone`` field can be modified based on your team's time zone based on `this list of timezone IDs <https://docs.oracle.com/middleware/12211/wcs/tag-ref/MISC/TimeZones.html>`__. The other parameters tell gversion where to put our file, what Java package it should be in, the name of the file, how to show the commit date, and indentation formatting.

.. code-block:: groovy

  project.compileJava.dependsOn(createVersionFile)
  gversion {
    srcDir       = "src/main/java/"
    classPackage = "frc.robot"
    className    = "BuildConstants"
    dateFormat   = "yyyy-MM-dd HH:mm:ss z"
    timeZone     = "America/New_York" // Use preferred time zone
    indent       = "  "
  }

To test this run a build of your project by clicking the WPILib logo in the top right of VS Code and searching for "Build Robot Code". Once the build has finished running there should be a file called ``BuildConstants.java`` in your Java folder. The following is an example of what this file should look like:

.. code-block:: Java

  package frc.robot;

  /**
  * Automatically generated file containing build version information.
  */
  public final class BuildConstants {
    public static final String MAVEN_GROUP = "";
    public static final String MAVEN_NAME = "GitVersionTest";
    public static final String VERSION = "unspecified";
    public static final int GIT_REVISION = 1;
    public static final String GIT_SHA = "fad108a4b1c1dcdfc8859c6295ea64e06d43f557";
    public static final String GIT_DATE = "2023-10-26 17:38:59 EDT";
    public static final String GIT_BRANCH = "main";
    public static final String BUILD_DATE = "2023-10-27 12:29:57 EDT";
    public static final long BUILD_UNIX_TIME = 1698424197122L;
    public static final int DIRTY = 0;

    private BuildConstants(){}
  }

Ignoring Generated Files with Git
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Since these files include data that is already tracked by Git and are regenerated every time code is deployed, it is recommended to not track these changes with Git by using the `gitignore <https://git-scm.com/docs/gitignore>`__ file. This file should exist by default in any project generated by the WPILib VS Code extension. Below is the line you should add to ignore the generated file:

.. code-block:: 

  src/main/java/frc/robot/BuildConstants.java

